<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>回归分析第12讲——基于R语言实现逻辑回归 | 生信人的知识库</title><meta name="author" content="Redamancy"><meta name="copyright" content="Redamancy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="这一讲为实践内容，我们将学习如何使用R语言建立和拟合逻辑回归模型，并对模型和参数进行假设检验。 本讲默认读者已经了解R语言的基本语法，能够在自己的电脑中成功编写和运行R脚本。 一、单个0-1响应的逻辑回归模型 1.1 数据集介绍与模型建立 我们先从最简单的情况开始。这里我们使用faraway包中的wcgs数据集，该数据集的收集过程是：在1960年挑选了约3000个年龄在39到59岁的健康男性作为受">
<meta property="og:type" content="article">
<meta property="og:title" content="回归分析第12讲——基于R语言实现逻辑回归">
<meta property="og:url" content="https://cien-su.github.io/2025/11/17/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E7%AC%AC12%E8%AE%B2%E2%80%94%E2%80%94%E5%9F%BA%E4%BA%8ER%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92/index.html">
<meta property="og:site_name" content="生信人的知识库">
<meta property="og:description" content="这一讲为实践内容，我们将学习如何使用R语言建立和拟合逻辑回归模型，并对模型和参数进行假设检验。 本讲默认读者已经了解R语言的基本语法，能够在自己的电脑中成功编写和运行R脚本。 一、单个0-1响应的逻辑回归模型 1.1 数据集介绍与模型建立 我们先从最简单的情况开始。这里我们使用faraway包中的wcgs数据集，该数据集的收集过程是：在1960年挑选了约3000个年龄在39到59岁的健康男性作为受">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cien-su.github.io/img/avatar.png">
<meta property="article:published_time" content="2025-11-17T02:47:39.000Z">
<meta property="article:modified_time" content="2025-11-17T09:29:22.505Z">
<meta property="article:author" content="Redamancy">
<meta property="article:tag" content="R">
<meta property="article:tag" content="广义线性回归">
<meta property="article:tag" content="广义逻辑回归">
<meta property="article:tag" content="逻辑回归">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cien-su.github.io/img/avatar.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "回归分析第12讲——基于R语言实现逻辑回归",
  "url": "https://cien-su.github.io/2025/11/17/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E7%AC%AC12%E8%AE%B2%E2%80%94%E2%80%94%E5%9F%BA%E4%BA%8ER%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92/",
  "image": "https://cien-su.github.io/img/avatar.png",
  "datePublished": "2025-11-17T02:47:39.000Z",
  "dateModified": "2025-11-17T09:29:22.505Z",
  "author": [
    {
      "@type": "Person",
      "name": "Redamancy",
      "url": "https://cien-su.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://cien-su.github.io/2025/11/17/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E7%AC%AC12%E8%AE%B2%E2%80%94%E2%80%94%E5%9F%BA%E4%BA%8ER%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":true,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '回归分析第12讲——基于R语言实现逻辑回归',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 8.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-th"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/background.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">生信人的知识库</span></a><a class="nav-page-title" href="/"><span class="site-name">回归分析第12讲——基于R语言实现逻辑回归</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-th"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">回归分析第12讲——基于R语言实现逻辑回归</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-11-17T02:47:39.000Z" title="发表于 2025-11-17 10:47:39">2025-11-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-11-17T09:29:22.505Z" title="更新于 2025-11-17 17:29:22">2025-11-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90/">回归分析</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">5.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>20分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>这一讲为实践内容，我们将学习如何使用R语言建立和拟合逻辑回归模型，并对模型和参数进行假设检验。</p>
<p>本讲默认读者已经了解R语言的基本语法，能够在自己的电脑中成功编写和运行R脚本。</p>
<h1>一、单个0-1响应的逻辑回归模型</h1>
<h2 id="1-1-数据集介绍与模型建立">1.1 数据集介绍与模型建立</h2>
<p>我们先从最简单的情况开始。这里我们使用<code>faraway</code>包中的<code>wcgs</code>数据集，该数据集的收集过程是：在1960年挑选了约3000个年龄在39到59岁的健康男性作为受访者，随访调查八年半，其间记录每个人每天的抽烟量，最后检查他们是否患上了心脏病。</p>
<p>这个数据集涉及的变量很多，这里我们只看这几列：<code>chd</code>是二分变量，表示是否患病；<code>height</code>是身高（英寸），<code>cigs</code>是每日吸烟量（支）：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="operator">&gt;</span> data<span class="punctuation">(</span>wcgs<span class="punctuation">,</span> package <span class="operator">=</span> <span class="string">&quot;faraway&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> summary<span class="punctuation">(</span>wcgs<span class="punctuation">[</span><span class="punctuation">,</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;chd&quot;</span><span class="punctuation">,</span><span class="string">&quot;height&quot;</span><span class="punctuation">,</span><span class="string">&quot;cigs&quot;</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">  chd           height           cigs     </span><br><span class="line"> no <span class="operator">:</span><span class="number">2897</span>   Min.   <span class="operator">:</span><span class="number">60.00</span>   Min.   <span class="operator">:</span> <span class="number">0.0</span>  </span><br><span class="line"> yes<span class="operator">:</span> <span class="number">257</span>   <span class="number">1</span>st Qu.<span class="operator">:</span><span class="number">68.00</span>   <span class="number">1</span>st Qu.<span class="operator">:</span> <span class="number">0.0</span>  </span><br><span class="line">            Median <span class="operator">:</span><span class="number">70.00</span>   Median <span class="operator">:</span> <span class="number">0.0</span>  </span><br><span class="line">            Mean   <span class="operator">:</span><span class="number">69.78</span>   Mean   <span class="operator">:</span><span class="number">11.6</span>  </span><br><span class="line">            <span class="number">3</span>rd Qu.<span class="operator">:</span><span class="number">72.00</span>   <span class="number">3</span>rd Qu.<span class="operator">:</span><span class="number">20.0</span>  </span><br><span class="line">            Max.   <span class="operator">:</span><span class="number">78.00</span>   Max.   <span class="operator">:</span><span class="number">99.0</span></span><br></pre></td></tr></table></figure>
<p>我们进行简单的可视化，看看在患病和不患病的受试者中，身高和吸烟量的分布情况：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>cowplot<span class="punctuation">)</span></span><br><span class="line">p1 <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>wcgs<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>height<span class="punctuation">,</span> color<span class="operator">=</span>chd<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">	geom_histogram<span class="punctuation">(</span>position <span class="operator">=</span> <span class="string">&quot;dodge&quot;</span><span class="punctuation">,</span> binwidth <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">p2 <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>wcgs<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>cigs<span class="punctuation">,</span> color<span class="operator">=</span>chd<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	geom_histogram<span class="punctuation">(</span>position <span class="operator">=</span> <span class="string">&quot;dodge&quot;</span><span class="punctuation">,</span> binwidth <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> </span><br><span class="line">					aes<span class="punctuation">(</span>y<span class="operator">=</span>..density..<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">plot_grid<span class="punctuation">(</span>p1<span class="punctuation">,</span> p2<span class="punctuation">,</span> ncol<span class="operator">=</span><span class="number">2</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><img src="12.1.1-1.png" alt="wcgs数据集可视化"></p>
<p>从左图中可以看到，患病与不患病人群在身高上的分布较为类似；从右图中可以看到，吸烟量的增加使得患病人数反超未患病人数。但是只从图上观察是不准确的，我们需要建立模型来确认患病与否跟身高、吸烟量的关系。</p>
<p>接下来我们开始建立逻辑回归模型。逻辑回归模型是广义线性回归模型，所以类似于线性回归模型的<code>lm()</code>语句，广义线性回归也有内置的<code>glm()</code>语句。由于我们要建立逻辑回归模型，响应变量是二分变量，所以只需额外指定<code>family</code>参数为<code>binomial</code>即可：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="operator">&gt;</span> lmod <span class="operator">&lt;-</span> glm<span class="punctuation">(</span>chd <span class="operator">~</span> height <span class="operator">+</span> cigs<span class="punctuation">,</span> family <span class="operator">=</span> binomial<span class="punctuation">,</span> wcgs<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> summary<span class="punctuation">(</span>lmod<span class="punctuation">)</span></span><br><span class="line">...</span><br><span class="line">Coefficients<span class="operator">:</span></span><br><span class="line">            Estimate Std. Error z value Pr<span class="punctuation">(</span><span class="operator">&gt;</span><span class="operator">|</span>z<span class="operator">|</span><span class="punctuation">)</span>    </span><br><span class="line"><span class="punctuation">(</span>Intercept<span class="punctuation">)</span> <span class="operator">-</span><span class="number">4.50161</span>    <span class="number">1.84186</span>  <span class="operator">-</span><span class="number">2.444</span>   <span class="number">0.0145</span> <span class="operator">*</span>  </span><br><span class="line">height       <span class="number">0.02521</span>    <span class="number">0.02633</span>   <span class="number">0.957</span>   <span class="number">0.3383</span>    </span><br><span class="line">cigs         <span class="number">0.02313</span>    <span class="number">0.00404</span>   <span class="number">5.724</span> <span class="number">1.04e-08</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line"><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span></span><br><span class="line">Signif. codes<span class="operator">:</span>  <span class="number">0</span> ‘<span class="operator">*</span><span class="operator">*</span><span class="operator">*</span>’ <span class="number">0.001</span> ‘<span class="operator">*</span><span class="operator">*</span>’ <span class="number">0.01</span> ‘<span class="operator">*</span>’ <span class="number">0.05</span> ‘.’ <span class="number">0.1</span> ‘ ’ <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">(</span>Dispersion parameter <span class="keyword">for</span> binomial family taken to be <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">    Null deviance<span class="operator">:</span> <span class="number">1781.2</span>  on <span class="number">3153</span>  degrees of freedom</span><br><span class="line">Residual deviance<span class="operator">:</span> <span class="number">1749.0</span>  on <span class="number">3151</span>  degrees of freedom</span><br><span class="line">AIC<span class="operator">:</span> <span class="number">1755</span></span><br><span class="line"></span><br><span class="line">Number of Fisher Scoring iterations<span class="operator">:</span> <span class="number">5</span></span><br></pre></td></tr></table></figure>
<p>如果你学习过之前的所有内容，那么这个输出就很容易看懂了。<code>Coefficients</code>部分给出了回归系数的估计值；<code>Deviance</code>值有两个，一个是零模型/最小模型的deviance，一个是残差/回归模型deviance；AIC是信息准则；最后给出了Fisher Scoring算法的迭代次数，通常是4~8次。</p>
<p>对于逻辑回归模型来说，只知道回归系数是不够的，不具有实际含义。由于回归系数代表了对<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>log</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>π</mi><mi mathvariant="normal">/</mi><mn>1</mn><mo>−</mo><mi>π</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\log(\pi/1-\pi)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mord">/1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mclose">)</span></span></span></span>的贡献，所以我们把回归系数转成<strong>几率</strong>来进行解读：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="punctuation">(</span>beta <span class="operator">&lt;-</span> coef<span class="punctuation">(</span>lmod<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">(</span>Intercept<span class="punctuation">)</span>      height        cigs </span><br><span class="line"><span class="operator">-</span><span class="number">4.50161397</span>  <span class="number">0.02520779</span>  <span class="number">0.02312740</span> </span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">exp</span><span class="punctuation">(</span>beta<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">(</span>Intercept<span class="punctuation">)</span>      height        cigs </span><br><span class="line"> <span class="number">0.01109108</span>  <span class="number">1.02552819</span>  <span class="number">1.02339691</span> </span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">exp</span><span class="punctuation">(</span>beta<span class="punctuation">[</span><span class="number">3</span><span class="punctuation">]</span><span class="operator">*</span><span class="number">20</span><span class="punctuation">)</span></span><br><span class="line">    cigs </span><br><span class="line"><span class="number">1.588115</span></span><br></pre></td></tr></table></figure>
<p>可以看到，身高和吸烟量的几率分别为1.026和1.0233，都是大于1的，所以如果两个系数的检验都通过的话，我们就可以说，身高增加1英寸，患病几率增加2.6%；或者每天多吸1支烟，患病几率增加2.3%。另外，如果每天吸了20支烟，患病优势增加59%。</p>
<h2 id="1-2-模型的检验">1.2 模型的检验</h2>
<p>拟合完一个模型之后，最重要的一件事就是做检验。我们首先考虑每一个回归系数的检验。</p>
<p>你可以看到输出结果中<code>Coefficients</code>部分有一个<code>z value</code>列，而在线性回归中这一列是<code>t value</code>。在理论部分我们推导过：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>b</mi><mo>∼</mo><mi>N</mi><mo stretchy="false">(</mo><mi>β</mi><mo separator="true">,</mo><msup><mi mathvariant="fraktur">I</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">b\sim N(\beta,\mathfrak I^{-1})
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathfrak">I</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<p>由于我们检验的目标是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">b_i=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>，所以进行标准化：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>z</mi><mi>i</mi></msub><mo>=</mo><mfrac><mrow><mi>b</mi><mo>−</mo><mn>0</mn></mrow><msqrt><mrow><mi>d</mi><mi>i</mi><mi>a</mi><mi>g</mi><mo stretchy="false">(</mo><msup><mi mathvariant="fraktur">I</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><msub><mo stretchy="false">)</mo><mi>i</mi></msub></mrow></msqrt></mfrac><mo>∼</mo><mi>N</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">z_i=\frac{b-0}{\sqrt{diag(\mathfrak I^{-1})_i}}\sim N(0,1)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.5014em;vertical-align:-1.13em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.175em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.935em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mord mathnormal">d</span><span class="mord mathnormal">ia</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord"><span class="mord mathfrak">I</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.895em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.28em" viewBox="0 0 400000 1296" preserveAspectRatio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.305em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.13em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span></p>
<p>这就是<code>z value</code>列的由来，你仍然可以尝试把<code>Estimate</code>列和<code>Std. Error</code>列相除，就可以得到<code>z value</code>的结果。</p>
<div class="tips">
<p><strong>为什么在逻辑回归中要使用z值（标准正态分布）而不是t值（t分布）？</strong></p>
<p>这是因为，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="fraktur">I</mi></mrow><annotation encoding="application/x-tex">\mathfrak I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6914em;"></span><span class="mord mathfrak">I</span></span></span></span>是确定的，无需估计的。</p>
<p>如果你还记得理论知识：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="fraktur">I</mi><mo>=</mo><msup><mi>X</mi><mi>T</mi></msup><mi>W</mi><mi>X</mi></mrow><annotation encoding="application/x-tex">\mathfrak I=X^TWX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6914em;"></span><span class="mord mathfrak">I</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8413em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span>，其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span>就是二项分布的方差，你就会发现方差是来自于结构（二项分布）而非样本，在大样本下，上述标准化就是服从正态分布的。</p>
<p>如果你回忆线性回归的回归系数的分布：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>β</mi><mo>^</mo></mover><mo>∼</mo><mi>N</mi><mo stretchy="false">(</mo><mi>β</mi><mo separator="true">,</mo><msup><mi>σ</mi><mn>2</mn></msup><mo stretchy="false">(</mo><msup><mi>X</mi><mi>T</mi></msup><mi>X</mi><msup><mo stretchy="false">)</mo><mo>−</mo></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\hat\beta\sim N(\beta,\sigma^2(X^TX)^-)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1523em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1667em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0913em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7713em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>，你就会发现<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi></mrow><annotation encoding="application/x-tex">\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span></span></span></span>是未知的，于是我们使用了<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>σ</mi><mo>^</mo></mover></mrow><annotation encoding="application/x-tex">\hat\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span></span></span></span>来代替了<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi></mrow><annotation encoding="application/x-tex">\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span></span></span></span>，即用<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mi>r</mi><mo stretchy="false">)</mo><msup><mover accent="true"><mi>σ</mi><mo>^</mo></mover><mn>2</mn></msup><mi mathvariant="normal">/</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">(n-r)\hat\sigma^2/n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">)</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord">/</span><span class="mord mathnormal">n</span></span></span></span>估计<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi></mrow><annotation encoding="application/x-tex">\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span></span></span></span>。既然我们对方差进行了估计，那么这种估计肯定是有误差的，这种误差会导致统计量存在拖尾的情况，因此使用t分布更为准确。</p>
<p>事实上，广义线性回归模型几乎都是使用z值来检验回归系数的。</p>
</div>
<p>接下来我们考虑模型的变量是否显著。我们之前学习的方法是，拟合不同的模型，然后调用<code>anova()</code>函数。这个方法在这里依然成立，你可以进行尝试，不过这里我们推荐一个更好的函数——<code>drop1()</code>，该函数可以自动地依次去掉一个自变量，然后与原模型做<strong>似然比检验</strong>，这样你就不需要手动搭建模型了：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="operator">&gt;</span> drop1<span class="punctuation">(</span>lmod<span class="punctuation">,</span> test<span class="operator">=</span><span class="string">&quot;Chi&quot;</span><span class="punctuation">)</span></span><br><span class="line">Single term deletions</span><br><span class="line"></span><br><span class="line">Model<span class="operator">:</span></span><br><span class="line">chd <span class="operator">~</span> height <span class="operator">+</span> cigs</span><br><span class="line">       Df Deviance    AIC     LRT Pr<span class="punctuation">(</span><span class="operator">&gt;</span>Chi<span class="punctuation">)</span>    </span><br><span class="line"><span class="operator">&lt;</span>none<span class="operator">&gt;</span>      <span class="number">1749.0</span> <span class="number">1755.0</span>                     </span><br><span class="line">height  <span class="number">1</span>   <span class="number">1750.0</span> <span class="number">1754.0</span>  <span class="number">0.9202</span>   <span class="number">0.3374</span>    </span><br><span class="line">cigs    <span class="number">1</span>   <span class="number">1780.1</span> <span class="number">1784.1</span> <span class="number">31.0695</span> <span class="number">2.49e-08</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line"><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span></span><br><span class="line">Signif. codes<span class="operator">:</span>  <span class="number">0</span> ‘<span class="operator">*</span><span class="operator">*</span><span class="operator">*</span>’ <span class="number">0.001</span> ‘<span class="operator">*</span><span class="operator">*</span>’ <span class="number">0.01</span> ‘<span class="operator">*</span>’ <span class="number">0.05</span> ‘.’ <span class="number">0.1</span> ‘ ’ <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>可以看到，当去掉<code>cigs</code>项时似然比检验显著，说明<code>cigs</code>确实是必不可少的项；而<code>height</code>在去掉前后对模型没有显著的影响，所以我们可以认为身高和患病之间不存在相关性。</p>
<p>最后提一下模型结构检验。在理论部分我们学过，要检验模型结构是否存在就可以使用Deviance检验，也就是分别求全模型和拟合模型的对数似然值，然后做似然比检验。<strong>但是</strong>，在R实践当中，你不能这样做，你不能真的这样写：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">glm<span class="punctuation">(</span>chd <span class="operator">~</span> factor<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span>n<span class="punctuation">)</span><span class="punctuation">,</span> family<span class="operator">=</span>binomial<span class="punctuation">,</span> data<span class="operator">=</span>wcgs<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>这样做是完全过拟合，往往不收敛甚至发生拟合错误。就算可以计算全模型的对数似然值，也无法直接检验，因为全模型的自由度为0。所以你会看到，<code>summary(lmod)</code>输出了<code>Residual deviance: 1749.0  on 3151  degrees of freedom</code>的字样，这里的Deviance值表示拟合模型和全模型的对数似然值的差，但是并不能做检验。</p>
<p>因此，一个更优的做法就是拟合<strong>最小模型/零模型</strong>，然后调用<code>anova()</code>函数：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="operator">&gt;</span> lmod_null <span class="operator">&lt;-</span> glm<span class="punctuation">(</span>chd <span class="operator">~</span> <span class="number">1</span><span class="punctuation">,</span> family<span class="operator">=</span>binomial<span class="punctuation">,</span> data<span class="operator">=</span>wcgs<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> anova<span class="punctuation">(</span>lmod_null<span class="punctuation">,</span> lmod<span class="punctuation">)</span></span><br><span class="line">Analysis of Deviance Table</span><br><span class="line"></span><br><span class="line">Model <span class="number">1</span><span class="operator">:</span> chd <span class="operator">~</span> <span class="number">1</span></span><br><span class="line">Model <span class="number">2</span><span class="operator">:</span> chd <span class="operator">~</span> height <span class="operator">+</span> cigs</span><br><span class="line">  Resid. Df Resid. Dev Df Deviance  Pr<span class="punctuation">(</span><span class="operator">&gt;</span>Chi<span class="punctuation">)</span>    </span><br><span class="line"><span class="number">1</span>      <span class="number">3153</span>     <span class="number">1781.2</span>                          </span><br><span class="line"><span class="number">2</span>      <span class="number">3151</span>     <span class="number">1749.0</span>  <span class="number">2</span>   <span class="number">32.195</span> <span class="number">1.021e-07</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line"><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span></span><br><span class="line">Signif. codes<span class="operator">:</span>  <span class="number">0</span> ‘<span class="operator">*</span><span class="operator">*</span><span class="operator">*</span>’ <span class="number">0.001</span> ‘<span class="operator">*</span><span class="operator">*</span>’ <span class="number">0.01</span> ‘<span class="operator">*</span>’ <span class="number">0.05</span> ‘.’ <span class="number">0.1</span> ‘ ’ <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>p值显著，说明模型结构是显著的。</p>
<h2 id="1-3-模型的诊断">1.3 模型的诊断</h2>
<p>1.2小节完成了显著性的检验，现在我们还需要进行模型的诊断。</p>
<p>首先是拟合优度检验。你会发现上面1.1小节中的<code>summary(lmod)</code>里没有输出决定系数，这是因为线性回归中的决定系数无法直接套用在逻辑回归中。在实际应用当中，我们一般使用HL检验和伪决定系数。</p>
<p>要实现HL检验，可以直接调用<code>ResourceSelection</code>包中的<code>hoslem.test()</code>函数：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#install.packages(&quot;ResourceSelection&quot;)</span></span><br><span class="line"><span class="operator">&gt;</span> library<span class="punctuation">(</span>ResourceSelection<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> hoslem.test<span class="punctuation">(</span>lmod<span class="operator">$</span>y<span class="punctuation">,</span> fitted<span class="punctuation">(</span>lmod<span class="punctuation">)</span><span class="punctuation">,</span> g<span class="operator">=</span><span class="number">10</span><span class="punctuation">)</span></span><br><span class="line">	Hosmer and Lemeshow goodness of fit <span class="punctuation">(</span>GOF<span class="punctuation">)</span> test</span><br><span class="line"></span><br><span class="line">data<span class="operator">:</span>  lmod<span class="operator">$</span>y<span class="punctuation">,</span> fitted<span class="punctuation">(</span>lmod<span class="punctuation">)</span></span><br><span class="line">X<span class="operator">-</span>squared <span class="operator">=</span> <span class="number">11.378</span><span class="punctuation">,</span> df <span class="operator">=</span> <span class="number">8</span><span class="punctuation">,</span> p<span class="operator">-</span>value <span class="operator">=</span> <span class="number">0.1812</span></span><br></pre></td></tr></table></figure>
<p>我们把数据分成了10组，即<code>g=10</code>，结果是p值不显著，说明拟合优度偏差未达到显著性水平。</p>
<p>要计算伪决定系数，我们可以使用<code>DescTools</code>中的<code>PseudoR2()</code>函数来实现：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#install.packages(&quot;DescTools&quot;)</span></span><br><span class="line"><span class="operator">&gt;</span> library<span class="punctuation">(</span>DescTools<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> PseudoR2<span class="punctuation">(</span>lmod<span class="punctuation">,</span> which <span class="operator">=</span> <span class="string">&quot;McFadden&quot;</span><span class="punctuation">)</span></span><br><span class="line">  McFadden </span><br><span class="line"><span class="number">0.01807417</span></span><br></pre></td></tr></table></figure>
<p>这里展示了理论知识中提到的McFadden版本的伪决定系数，你还可以选择其他版本的伪决定系数，详情可以通过<code>?PseudoR2</code>来查询。</p>
<p>接下来看看残差。如果要获取每个样本的残差，可以使用<code>residuals(lmod)</code>。这里的残差默认是Deviance残差，如果你要使用Pearson残差，那就调用<code>residuals(lmod, type=&quot;pearson&quot;)</code>；如果你想调用的是观测值（0/1）和拟合值（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi></mrow><annotation encoding="application/x-tex">\pi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span></span></span></span>）之间的“残差”，那就调用<code>residuals(lmod, tupe=&quot;response&quot;)</code>。获得残差以后，就可以做各种残差诊断，如正态性、等方差性、独立性等等，和线性回归没有区别。</p>
<div class="tips">
<p>这里还没提到过度分散问题，我们在第二节进行展开。</p>
</div>
<h1>二、多个0-1响应的逻辑回归模型</h1>
<p>上一节我们介绍了单个0-1响应的逻辑回归模型，接下来我们要拓展到多个0-1响应。多个0-1响应本质上就是理论学习部分的“<strong>分组处理</strong>”，即在某个<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\pi_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>水平下有多条数据，而不是以每条数据单独分组。这种处理类似于“<strong>批次</strong>”的概念，我们讨论的是每个批次的成功概率，而不是单个样本的成功与否。</p>
<h2 id="2-1-数据集介绍与模型建立">2.1 数据集介绍与模型建立</h2>
<p>1986年，航天飞机“挑战者号”在发射升空后爆炸。经过调查，工程师们把目光聚焦在火箭助推器的橡胶O型密封圈上。他们发现，在低温环境下，橡胶会变脆导致密封性变差。而在回顾之前已经完成的23次火箭发射任务，他们的确也发现了O型密封圈的损坏。那么是否可以把温度和密封圈的损坏联系起来呢？</p>
<p><code>faraway</code>包中的<code>orings</code>数据集描述了每一个火箭的O型密封圈所处的温度和损坏的个数。每一个火箭有2个助推器，每个助推器有3个O型密封圈，也就是说，一个火箭有6个密封圈。<code>damage</code>列记录了每个火箭O型密封圈的损坏个数，<code>temp</code>列记录了温度。我们可以绘制O型密封圈损坏比例和温度的关系图：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="operator">&gt;</span> data<span class="punctuation">(</span>orings<span class="punctuation">,</span> package <span class="operator">=</span> <span class="string">&quot;faraway&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> plot<span class="punctuation">(</span>damage<span class="operator">/</span><span class="number">6</span> <span class="operator">~</span> temp<span class="punctuation">,</span> orings<span class="punctuation">,</span> xlim<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">25</span><span class="punctuation">,</span><span class="number">85</span><span class="punctuation">)</span><span class="punctuation">,</span> ylim<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line"><span class="operator">+</span>      xlab<span class="operator">=</span><span class="string">&quot;Temperature&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;Prob of damage&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><img src="12.2.1-1.png" alt="orings数据集可视化"></p>
<p>在这个数据中，我们讨论的是每个火箭的O型密封圈损坏的比例，而不是每个密封圈是否损坏；另外，处于同一个火箭的密封圈的温度应该是一致的，所以没必要重复地使用同一水平的自变量。因此，这里我们采取n次二项分布来描述响应变量的分布。</p>
<p>对于多个0-1响应的逻辑回归模型，在搭建模型的步骤方面和单个0-1响应的模型是一致的，但是存在一点不同：对于多个0-1响应来说，公式部分的<code>y</code>不能只放<code>damage</code>，而是应该<strong>放一个两列的矩阵</strong>，第1列是事件成功次数（这里是发生损坏的次数），第2列是事件失败次数（这里是6-损坏次数），这样才能正确建模：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="operator">&gt;</span> lmod <span class="operator">&lt;-</span> glm<span class="punctuation">(</span>cbind<span class="punctuation">(</span>damage<span class="punctuation">,</span><span class="number">6</span><span class="operator">-</span>damage<span class="punctuation">)</span> <span class="operator">~</span> temp<span class="punctuation">,</span> family <span class="operator">=</span> binomial<span class="punctuation">,</span> orings<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> summary<span class="punctuation">(</span>lmod<span class="punctuation">)</span></span><br><span class="line">...</span><br><span class="line">Coefficients<span class="operator">:</span></span><br><span class="line">            Estimate Std. Error z value Pr<span class="punctuation">(</span><span class="operator">&gt;</span><span class="operator">|</span>z<span class="operator">|</span><span class="punctuation">)</span>    </span><br><span class="line"><span class="punctuation">(</span>Intercept<span class="punctuation">)</span> <span class="number">11.66299</span>    <span class="number">3.29626</span>   <span class="number">3.538</span> <span class="number">0.000403</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">temp        <span class="operator">-</span><span class="number">0.21623</span>    <span class="number">0.05318</span>  <span class="operator">-</span><span class="number">4.066</span> <span class="number">4.78e-05</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line"><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span></span><br><span class="line">Signif. codes<span class="operator">:</span>  <span class="number">0</span> ‘<span class="operator">*</span><span class="operator">*</span><span class="operator">*</span>’ <span class="number">0.001</span> ‘<span class="operator">*</span><span class="operator">*</span>’ <span class="number">0.01</span> ‘<span class="operator">*</span>’ <span class="number">0.05</span> ‘.’ <span class="number">0.1</span> ‘ ’ <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">(</span>Dispersion parameter <span class="keyword">for</span> binomial family taken to be <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">    Null deviance<span class="operator">:</span> <span class="number">38.898</span>  on <span class="number">22</span>  degrees of freedom</span><br><span class="line">Residual deviance<span class="operator">:</span> <span class="number">16.912</span>  on <span class="number">21</span>  degrees of freedom</span><br><span class="line">AIC<span class="operator">:</span> <span class="number">33.675</span></span><br><span class="line"></span><br><span class="line">Number of Fisher Scoring iterations<span class="operator">:</span> <span class="number">6</span></span><br></pre></td></tr></table></figure>
<p>后续的分析步骤就和第一节完全一样，这里不再赘述，下面我们着重探讨过度分散的问题。</p>
<h2 id="2-2-过度分散及其解决">2.2 过度分散及其解决</h2>
<p>在理论知识部分我们提到，逻辑回归有可能会出现过度分散问题，也就是说观测值的方差大于模型估计方差，使得模型不能完全解释数据中的方差波动。解决方法是引入一个分散参数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ϕ</span></span></span></span>，使得<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>a</mi><mi>r</mi><mo stretchy="false">(</mo><msub><mi>Y</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mi>ϕ</mi><msub><mi>p</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msub><mi>p</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Var(Y_i)=\phi p_i(1-p_i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ϕ</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>。这个分散参数是可以手动估计的：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>ϕ</mi><mo>=</mo><mfrac><msup><mi>χ</mi><mn>2</mn></msup><mrow><mi>N</mi><mo>−</mo><mi>p</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\phi=\frac{\chi^2}{N-p}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ϕ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3715em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">p</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">χ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>χ</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\chi^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0085em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">χ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>是模型拟合优度的Pearson卡方值。</p>
<p>在<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span>语言中，我们可以这样写：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sum</span><span class="punctuation">(</span>residuals<span class="punctuation">(</span>model<span class="punctuation">,</span> type<span class="operator">=</span><span class="string">&quot;pearson&quot;</span><span class="punctuation">)</span><span class="operator">^</span><span class="number">2</span><span class="operator">/</span><span class="punctuation">(</span>N<span class="operator">-</span>p<span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>上面是伪代码，在实际使用时需要替换model, N, p。如果你发现<strong>分散参数大于1</strong>，那说明模型存在过度分散问题。</p>
<p>我们使用2.1小节的例子，估计分散参数：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="built_in">sum</span><span class="punctuation">(</span>residuals<span class="punctuation">(</span>lmod<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;pearson&quot;</span><span class="punctuation">)</span><span class="operator">^</span><span class="number">2</span><span class="operator">/</span><span class="number">21</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">1.336542</span></span><br></pre></td></tr></table></figure>
<p>可以看到，上述搭建的模型是存在过度分散的。其实也不奇怪，从2.1小节的图中就可以看到，&gt;0.5的数据和&lt;0.5数据的量完全不对等。</p>
<p>要解决过度分散问题，我们可以使用拟二项分布（quasi-binomial）。要实现这一点很简单，只需要指定<code>family</code>参数为<code>quasibinomial</code>即可：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="operator">&gt;</span> lmod <span class="operator">&lt;-</span> glm<span class="punctuation">(</span>cbind<span class="punctuation">(</span>damage<span class="punctuation">,</span><span class="number">6</span><span class="operator">-</span>damage<span class="punctuation">)</span> <span class="operator">~</span> temp<span class="punctuation">,</span> family <span class="operator">=</span> quasibinomial<span class="punctuation">,</span> orings<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> summary<span class="punctuation">(</span>lmod<span class="punctuation">)</span></span><br><span class="line">...</span><br><span class="line">Coefficients<span class="operator">:</span></span><br><span class="line">            Estimate Std. Error t value Pr<span class="punctuation">(</span><span class="operator">&gt;</span><span class="operator">|</span>t<span class="operator">|</span><span class="punctuation">)</span>   </span><br><span class="line"><span class="punctuation">(</span>Intercept<span class="punctuation">)</span> <span class="number">11.66299</span>    <span class="number">3.81077</span>   <span class="number">3.061</span>  <span class="number">0.00594</span> <span class="operator">*</span><span class="operator">*</span></span><br><span class="line">temp        <span class="operator">-</span><span class="number">0.21623</span>    <span class="number">0.06148</span>  <span class="operator">-</span><span class="number">3.517</span>  <span class="number">0.00205</span> <span class="operator">*</span><span class="operator">*</span></span><br><span class="line"><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span></span><br><span class="line">Signif. codes<span class="operator">:</span>  <span class="number">0</span> ‘<span class="operator">*</span><span class="operator">*</span><span class="operator">*</span>’ <span class="number">0.001</span> ‘<span class="operator">*</span><span class="operator">*</span>’ <span class="number">0.01</span> ‘<span class="operator">*</span>’ <span class="number">0.05</span> ‘.’ <span class="number">0.1</span> ‘ ’ <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">(</span>Dispersion parameter <span class="keyword">for</span> quasibinomial family taken to be <span class="number">1.336542</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">    Null deviance<span class="operator">:</span> <span class="number">38.898</span>  on <span class="number">22</span>  degrees of freedom</span><br><span class="line">Residual deviance<span class="operator">:</span> <span class="number">16.912</span>  on <span class="number">21</span>  degrees of freedom</span><br><span class="line">AIC<span class="operator">:</span> <span class="literal">NA</span></span><br><span class="line"></span><br><span class="line">Number of Fisher Scoring iterations<span class="operator">:</span> <span class="number">6</span></span><br></pre></td></tr></table></figure>
<p>拟二项分布不会改变参数估计的结果，但是会改变方差，从而对显著性p值进行了修正。</p>
<h1>三、广义逻辑回归模型</h1>
<p>最后我们介绍广义逻辑回归模型，这里我们只考虑模型建立的问题，后续的检验和诊断就不再反复赘述。</p>
<h2 id="3-1-多分类无序逻辑回归模型">3.1 多分类无序逻辑回归模型</h2>
<p>多分类无序逻辑回归是指，联系函数仍然为逻辑函数，但是响应变量服从多项分布，且类与类之间不存在先后关系。这类模型之所以是广义逻辑回归模型，是因为它仍然使用了逻辑函数，并且我们在建模时，选取某一类为参考类，剩下的每一类都分别与参考类构成二项分布的关系。</p>
<p>我们以Rosenstone发表的关于1996年美国大选研究的数据为例，展示多分类无序逻辑回归模型的建立过程。为了简化，我们只考虑受访者的年龄、教育水平、经济收入水平，并探讨这些变量和他们加入的党派之间的关系。我们只考虑三类党派：民主党（Democrat）、独立派（Independent）、共和党（Republican），因此我们需要进行一定的数据重排：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="operator">&gt;</span> data<span class="punctuation">(</span>nes96<span class="punctuation">,</span> package <span class="operator">=</span> <span class="string">&quot;faraway&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> party <span class="operator">&lt;-</span> nes96<span class="operator">$</span>PID</span><br><span class="line"><span class="operator">&gt;</span> levels<span class="punctuation">(</span>party<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Democrat&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Democrat&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Independent&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Independent&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="operator">+</span> <span class="string">&quot;Independent&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Republican&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Republican&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> inca <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1.5</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">6</span><span class="punctuation">,</span><span class="number">8</span><span class="punctuation">,</span><span class="number">9.5</span><span class="punctuation">,</span><span class="number">10.5</span><span class="punctuation">,</span><span class="number">11.5</span><span class="punctuation">,</span><span class="number">12.5</span><span class="punctuation">,</span><span class="number">13.5</span><span class="punctuation">,</span><span class="number">14.5</span><span class="punctuation">,</span><span class="number">16</span><span class="punctuation">,</span><span class="number">18.5</span><span class="punctuation">,</span><span class="number">21</span><span class="punctuation">,</span><span class="number">23.5</span><span class="punctuation">,</span></span><br><span class="line"><span class="operator">+</span> <span class="number">27.5</span><span class="punctuation">,</span><span class="number">32.5</span><span class="punctuation">,</span><span class="number">37.5</span><span class="punctuation">,</span><span class="number">42.5</span><span class="punctuation">,</span><span class="number">47.5</span><span class="punctuation">,</span><span class="number">55</span><span class="punctuation">,</span><span class="number">67.5</span><span class="punctuation">,</span><span class="number">82.5</span><span class="punctuation">,</span><span class="number">97.5</span><span class="punctuation">,</span><span class="number">115</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> income <span class="operator">&lt;-</span> inca<span class="punctuation">[</span><span class="built_in">unclass</span><span class="punctuation">(</span>nes96<span class="operator">$</span>income<span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> rnes96 <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>party<span class="punctuation">,</span> income<span class="punctuation">,</span> education<span class="operator">=</span>nes96<span class="operator">$</span>educ<span class="punctuation">,</span> age<span class="operator">=</span>nes96<span class="operator">$</span>age<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> summary<span class="punctuation">(</span>rnes96<span class="punctuation">)</span></span><br><span class="line">         party         income        education        age       </span><br><span class="line"> Democrat   <span class="operator">:</span><span class="number">380</span>   Min.   <span class="operator">:</span>  <span class="number">1.50</span>   MS    <span class="operator">:</span> <span class="number">13</span>   Min.   <span class="operator">:</span><span class="number">19.00</span>  </span><br><span class="line"> Independent<span class="operator">:</span><span class="number">239</span>   <span class="number">1</span>st Qu.<span class="operator">:</span> <span class="number">23.50</span>   HSdrop<span class="operator">:</span> <span class="number">52</span>   <span class="number">1</span>st Qu.<span class="operator">:</span><span class="number">34.00</span>  </span><br><span class="line"> Republican <span class="operator">:</span><span class="number">325</span>   Median <span class="operator">:</span> <span class="number">37.50</span>   HS    <span class="operator">:</span><span class="number">248</span>   Median <span class="operator">:</span><span class="number">44.00</span>  </span><br><span class="line">                   Mean   <span class="operator">:</span> <span class="number">46.58</span>   Coll  <span class="operator">:</span><span class="number">187</span>   Mean   <span class="operator">:</span><span class="number">47.04</span>  </span><br><span class="line">                   <span class="number">3</span>rd Qu.<span class="operator">:</span> <span class="number">67.50</span>   CCdeg <span class="operator">:</span> <span class="number">90</span>   <span class="number">3</span>rd Qu.<span class="operator">:</span><span class="number">58.00</span>  </span><br><span class="line">                   Max.   <span class="operator">:</span><span class="number">115.00</span>   BAdeg <span class="operator">:</span><span class="number">227</span>   Max.   <span class="operator">:</span><span class="number">91.00</span>  </span><br><span class="line">                                    MAdeg <span class="operator">:</span><span class="number">127</span></span><br></pre></td></tr></table></figure>
<p>接下来我们来建立模型。要建立多分类无序逻辑回归，我们可以使用<code>nnet</code>包中的<code>multinom()</code>函数。<code>nnet</code>包是一个神经网络包，但是我们只需要使用神经网络训练器里面的优化方法来计算极大似然估计，不涉及到更深的网络。这样做的原因是，用这个优化方法会更快：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="operator">&gt;</span> library<span class="punctuation">(</span>nnet<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> mmod <span class="operator">&lt;-</span> multinom<span class="punctuation">(</span>party <span class="operator">~</span> age <span class="operator">+</span> education <span class="operator">+</span> income<span class="punctuation">,</span> rnes96<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># weights:  30 (18 variable)</span></span><br><span class="line">initial  value <span class="number">1037.090001</span> </span><br><span class="line">iter  <span class="number">10</span> value <span class="number">990.568608</span></span><br><span class="line">iter  <span class="number">20</span> value <span class="number">984.319052</span></span><br><span class="line">final  value <span class="number">984.166272</span> </span><br><span class="line">converged</span><br><span class="line"><span class="operator">&gt;</span> mmodi <span class="operator">&lt;-</span> step<span class="punctuation">(</span>mmod<span class="punctuation">)</span></span><br><span class="line">...</span><br><span class="line"><span class="operator">&gt;</span> summary<span class="punctuation">(</span>mmodi<span class="punctuation">)</span></span><br><span class="line">Call<span class="operator">:</span></span><br><span class="line">multinom<span class="punctuation">(</span>formula <span class="operator">=</span> party <span class="operator">~</span> income<span class="punctuation">,</span> data <span class="operator">=</span> rnes96<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">Coefficients<span class="operator">:</span></span><br><span class="line">            <span class="punctuation">(</span>Intercept<span class="punctuation">)</span>     income</span><br><span class="line">Independent  <span class="operator">-</span><span class="number">1.1749331</span> <span class="number">0.01608683</span></span><br><span class="line">Republican   <span class="operator">-</span><span class="number">0.9503591</span> <span class="number">0.01766457</span></span><br><span class="line"></span><br><span class="line">Std. Errors<span class="operator">:</span></span><br><span class="line">            <span class="punctuation">(</span>Intercept<span class="punctuation">)</span>      income</span><br><span class="line">Independent   <span class="number">0.1536103</span> <span class="number">0.002849738</span></span><br><span class="line">Republican    <span class="number">0.1416859</span> <span class="number">0.002652532</span></span><br><span class="line"></span><br><span class="line">Residual Deviance<span class="operator">:</span> <span class="number">1985.424</span> </span><br><span class="line">AIC<span class="operator">:</span> <span class="number">1993.424</span></span><br></pre></td></tr></table></figure>
<p>这种方法训练速度很快。我们通过<code>step()</code>进行了简单的筛选，最终只保留了<code>income</code>这个变量。</p>
<p>或者，如果你想要类似于<code>glm()</code>的写法，一个更通用的包是<code>VGAM</code>，使用其中的<code>vglm()</code>函数，指定<code>family=multinomial</code>即可：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#install.packages(&quot;VGAM&quot;)</span></span><br><span class="line">library<span class="punctuation">(</span>VGAM<span class="punctuation">)</span></span><br><span class="line">mmod <span class="operator">&lt;-</span> vglm<span class="punctuation">(</span>party <span class="operator">~</span> age <span class="operator">+</span> education <span class="operator">+</span> income<span class="punctuation">,</span> family <span class="operator">=</span> multinomial<span class="punctuation">,</span> rnes96<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h2 id="3-2-多分类有序逻辑回归模型">3.2 多分类有序逻辑回归模型</h2>
<p>如果响应变量不仅服从多项分布，每个类别之间还有顺序关系，那么我们就需要使用多分类有序逻辑回归模型了。在理论部分我们提到，多分类有序逻辑回归模型大致有三类：</p>
<ul>
<li>比例几率模型（Proportional Odds Model, PO）</li>
<li>相邻类别模型（Adjacent Categories Model, AC）</li>
<li>连续比例模型（Continuation Ratio Model, CR）</li>
</ul>
<p>在实际情况下，我们需要根据研究内容的特点来选择合适的模型。这里我们以PO模型为例。</p>
<p>我们仍然以3.1小节中构造的数据集为例，我们假设三个党派是有顺序关系的（虽然事实上并没有，这里只是为了简便），例如，我们假设独立派在民主党与共和党之间。要建立PO模型，我们使用<code>MASS</code>包中的<code>polr()</code>函数来完成：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="operator">&gt;</span> library<span class="punctuation">(</span>MASS<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> pomod <span class="operator">&lt;-</span> polr<span class="punctuation">(</span>party <span class="operator">~</span> age <span class="operator">+</span> education <span class="operator">+</span> income<span class="punctuation">,</span> rnes96<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> summary<span class="punctuation">(</span>pomod<span class="punctuation">)</span></span><br><span class="line"><span class="built_in">Re</span><span class="operator">-</span>fitting to get Hessian</span><br><span class="line">...</span><br><span class="line">Coefficients<span class="operator">:</span></span><br><span class="line">                Value Std. Error  t value</span><br><span class="line">age          <span class="number">0.005775</span>   <span class="number">0.003887</span>  <span class="number">1.48581</span></span><br><span class="line">education.L  <span class="number">0.724087</span>   <span class="number">0.384388</span>  <span class="number">1.88374</span></span><br><span class="line">education.Q <span class="operator">-</span><span class="number">0.781361</span>   <span class="number">0.351173</span> <span class="operator">-</span><span class="number">2.22500</span></span><br><span class="line">education.C  <span class="number">0.040168</span>   <span class="number">0.291762</span>  <span class="number">0.13767</span></span><br><span class="line">education<span class="operator">^</span><span class="number">4</span> <span class="operator">-</span><span class="number">0.019925</span>   <span class="number">0.232429</span> <span class="operator">-</span><span class="number">0.08573</span></span><br><span class="line">education<span class="operator">^</span><span class="number">5</span> <span class="operator">-</span><span class="number">0.079413</span>   <span class="number">0.191533</span> <span class="operator">-</span><span class="number">0.41462</span></span><br><span class="line">education<span class="operator">^</span><span class="number">6</span> <span class="operator">-</span><span class="number">0.061104</span>   <span class="number">0.157747</span> <span class="operator">-</span><span class="number">0.38735</span></span><br><span class="line">income       <span class="number">0.012739</span>   <span class="number">0.002140</span>  <span class="number">5.95187</span></span><br><span class="line"></span><br><span class="line">Intercepts<span class="operator">:</span></span><br><span class="line">                       Value   Std. Error t value</span><br><span class="line">Democrat<span class="operator">|</span>Independent    <span class="number">0.6449</span>  <span class="number">0.2435</span>     <span class="number">2.6479</span></span><br><span class="line">Independent<span class="operator">|</span>Republican  <span class="number">1.7374</span>  <span class="number">0.2493</span>     <span class="number">6.9694</span></span><br><span class="line"></span><br><span class="line">Residual Deviance<span class="operator">:</span> <span class="number">1984.211</span> </span><br><span class="line">AIC<span class="operator">:</span> <span class="number">2004.211</span></span><br></pre></td></tr></table></figure>
<p>如果你对模型使用<code>step()</code>，你会发现还是只跟<code>income</code>有关。</p>
<p>当然，<code>VGAM</code>包更全面，你仍然只需要使用<code>vglm()</code>函数，并且指定<code>family = cumulative(link=&quot;logit&quot;)</code>即可。另外，对于AC模型，可以参考<code>VGAM</code>包中的<code>acat()</code>；对于CR模型，可以参考<code>VGAM</code>包中的<code>cratio()</code>。所以说，<code>VGAM</code>包算是更为通用的包。</p>
<h2 id="3-3-二项响应的不同联系函数">3.3 二项响应的不同联系函数</h2>
<p>最后我们来看二项响应的不同联系函数。虽然使用别的联系函数已经不能称之为”逻辑回归“了，但是为了完整性，我们还是要介绍如何使用其他联系函数。不过请注意，这里所谓的”其他联系函数“要<strong>和响应变量的二项分布相适应</strong>，不是随便用一个联系函数就可以。</p>
<p>如果响应变量服从二项分布，那么除了逻辑函数，还有常见的比如Probit模型（标准正态分布连接）、log-log模型（两层对数连接）、cauchit模型（Cauchy分布连接）等。在<code>glm()</code>的<code>family</code>参数处，<code>binomial</code>默认是logit连接，也就是逻辑回归。要使用其他联系函数只需要在这个基础上进行修改即可。</p>
<p>我们以<code>bliss</code>数据集为例，该数据集记录了不同杀虫剂浓度对昆虫死亡比例的影响：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="operator">&gt;</span> data<span class="punctuation">(</span>bliss<span class="punctuation">,</span> package <span class="operator">=</span> <span class="string">&quot;faraway&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> bliss</span><br><span class="line">  dead alive conc</span><br><span class="line"><span class="number">1</span>    <span class="number">2</span>    <span class="number">28</span>    <span class="number">0</span></span><br><span class="line"><span class="number">2</span>    <span class="number">8</span>    <span class="number">22</span>    <span class="number">1</span></span><br><span class="line"><span class="number">3</span>   <span class="number">15</span>    <span class="number">15</span>    <span class="number">2</span></span><br><span class="line"><span class="number">4</span>   <span class="number">23</span>     <span class="number">7</span>    <span class="number">3</span></span><br><span class="line"><span class="number">5</span>   <span class="number">27</span>     <span class="number">3</span>    <span class="number">4</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="operator">&gt;</span> mlogit <span class="operator">&lt;-</span> glm<span class="punctuation">(</span>cbind<span class="punctuation">(</span>dead<span class="punctuation">,</span>alive<span class="punctuation">)</span><span class="operator">~</span>conc<span class="punctuation">,</span> family<span class="operator">=</span>binomial<span class="punctuation">,</span> data<span class="operator">=</span>bliss<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> mprobit <span class="operator">&lt;-</span> glm<span class="punctuation">(</span>cbind<span class="punctuation">(</span>dead<span class="punctuation">,</span>alive<span class="punctuation">)</span><span class="operator">~</span>conc<span class="punctuation">,</span> family<span class="operator">=</span>binomial<span class="punctuation">(</span>link<span class="operator">=</span>probit<span class="punctuation">)</span><span class="punctuation">,</span> data<span class="operator">=</span>bliss<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> mcloglog <span class="operator">&lt;-</span> glm<span class="punctuation">(</span>cbind<span class="punctuation">(</span>dead<span class="punctuation">,</span>alive<span class="punctuation">)</span><span class="operator">~</span>conc<span class="punctuation">,</span> family<span class="operator">=</span>binomial<span class="punctuation">(</span>link<span class="operator">=</span>cloglog<span class="punctuation">)</span><span class="punctuation">,</span> data<span class="operator">=</span>bliss<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> mcauchit <span class="operator">&lt;-</span> glm<span class="punctuation">(</span>cbind<span class="punctuation">(</span>dead<span class="punctuation">,</span>alive<span class="punctuation">)</span><span class="operator">~</span>conc<span class="punctuation">,</span> family<span class="operator">=</span>binomial<span class="punctuation">(</span>link<span class="operator">=</span>cauchit<span class="punctuation">)</span><span class="punctuation">,</span> data<span class="operator">=</span>bliss<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>我们来对比一下四个模型的拟合值：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="operator">&gt;</span> predval <span class="operator">&lt;-</span> sapply<span class="punctuation">(</span><span class="built_in">list</span><span class="punctuation">(</span>mlogit<span class="punctuation">,</span>mprobit<span class="punctuation">,</span>mcloglog<span class="punctuation">,</span>mcauchit<span class="punctuation">)</span><span class="punctuation">,</span> fitted<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">dimnames</span><span class="punctuation">(</span>predval<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span><span class="number">0</span><span class="operator">:</span><span class="number">4</span><span class="punctuation">,</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;logit&quot;</span><span class="punctuation">,</span><span class="string">&quot;probit&quot;</span><span class="punctuation">,</span><span class="string">&quot;cloglog&quot;</span><span class="punctuation">,</span><span class="string">&quot;cauchit&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">round</span><span class="punctuation">(</span>predval<span class="punctuation">,</span><span class="number">3</span><span class="punctuation">)</span></span><br><span class="line">  logit probit cloglog cauchit</span><br><span class="line"><span class="number">0</span> <span class="number">0.089</span>  <span class="number">0.084</span>   <span class="number">0.127</span>   <span class="number">0.119</span></span><br><span class="line"><span class="number">1</span> <span class="number">0.238</span>  <span class="number">0.245</span>   <span class="number">0.250</span>   <span class="number">0.213</span></span><br><span class="line"><span class="number">2</span> <span class="number">0.500</span>  <span class="number">0.498</span>   <span class="number">0.455</span>   <span class="number">0.506</span></span><br><span class="line"><span class="number">3</span> <span class="number">0.762</span>  <span class="number">0.752</span>   <span class="number">0.722</span>   <span class="number">0.791</span></span><br><span class="line"><span class="number">4</span> <span class="number">0.911</span>  <span class="number">0.914</span>   <span class="number">0.933</span>   <span class="number">0.882</span></span><br></pre></td></tr></table></figure>
<p>看起来它们的区别是有但不多的。如何选择这几个联系函数不能单单靠数据本身，有时候还需要实际经验、领域知识以及便利性。比如在生物医学和临床队列方面，可能就用逻辑回归模型是最佳的，因为它数学表达简单、容易解释OR值、适合前瞻性和回顾性研究；对于一些金融、博弈方面的模型，或许用probit或log-log模型更好。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://cien-su.github.io">Redamancy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://cien-su.github.io/2025/11/17/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E7%AC%AC12%E8%AE%B2%E2%80%94%E2%80%94%E5%9F%BA%E4%BA%8ER%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92/">https://cien-su.github.io/2025/11/17/回归分析/回归分析第12讲——基于R语言实现逻辑回归/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://cien-su.github.io" target="_blank">生信人的知识库</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%B9%BF%E4%B9%89%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/">广义线性回归</a><a class="post-meta__tags" href="/tags/%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92/">逻辑回归</a><a class="post-meta__tags" href="/tags/%E5%B9%BF%E4%B9%89%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92/">广义逻辑回归</a><a class="post-meta__tags" href="/tags/R/">R</a></div><div class="post-share"><div class="social-share" data-image="/img/avatar.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/11/10/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E7%AC%AC11%E8%AE%B2%E2%80%94%E2%80%94%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92%E6%A8%A1%E5%9E%8B/" title="回归分析第11讲——逻辑回归模型"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">回归分析第11讲——逻辑回归模型</div></div><div class="info-2"><div class="info-item-1">逻辑回归模型是广义线性回归中一个非常经典的模型，其架构在今天很多研究当中也在使用。由于逻辑回归模型中的响应变量是二分类随机变量，因此我们先从二分类随机变量开始讲起，逐步过渡到逻辑回归。 1.1 二分类随机变量与二项分布 二分类随机变量(Binary Random Variable)是指一个随机变量只取两个数，一般是0和1。二分类随机变量在实际生活中很常见，比如你可以用二分类随机变量描述一个人患病还是没患病： Z={1,患病0,未病Z=\begin{cases} 1,&amp;患病\\ 0,&amp;未病 \end{cases} Z={1,0,​患病未病​ 根据概率论的知识我们知道，二分类随机变量是离散的随机变量，因此我们只能用分布律来描述，即：    Z 1 0     Pr π\piπ 1−π1-\pi1−π    显然，ZZZ服从二项分布（伯努利分布），记作Z∼B(1,π)Z\sim B(1,\pi)Z∼B(1,π)，π=Pr(Z=1)\pi=Pr(Z=1)π=Pr(Z=1)。这里的π\piπ就可以相当于患病率。 进一步地，由于我们调查的人数不止1个，因此如果有nnn个人，每...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/11/10/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E7%AC%AC11%E8%AE%B2%E2%80%94%E2%80%94%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92%E6%A8%A1%E5%9E%8B/" title="回归分析第11讲——逻辑回归模型"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-10</div><div class="info-item-2">回归分析第11讲——逻辑回归模型</div></div><div class="info-2"><div class="info-item-1">逻辑回归模型是广义线性回归中一个非常经典的模型，其架构在今天很多研究当中也在使用。由于逻辑回归模型中的响应变量是二分类随机变量，因此我们先从二分类随机变量开始讲起，逐步过渡到逻辑回归。 1.1 二分类随机变量与二项分布 二分类随机变量(Binary Random Variable)是指一个随机变量只取两个数，一般是0和1。二分类随机变量在实际生活中很常见，比如你可以用二分类随机变量描述一个人患病还是没患病： Z={1,患病0,未病Z=\begin{cases} 1,&amp;患病\\ 0,&amp;未病 \end{cases} Z={1,0,​患病未病​ 根据概率论的知识我们知道，二分类随机变量是离散的随机变量，因此我们只能用分布律来描述，即：    Z 1 0     Pr π\piπ 1−π1-\pi1−π    显然，ZZZ服从二项分布（伯努利分布），记作Z∼B(1,π)Z\sim B(1,\pi)Z∼B(1,π)，π=Pr(Z=1)\pi=Pr(Z=1)π=Pr(Z=1)。这里的π\piπ就可以相当于患病率。 进一步地，由于我们调查的人数不止1个，因此如果有nnn个人，每...</div></div></div></a><a class="pagination-related" href="/2025/11/06/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E7%AC%AC10%E8%AE%B2%E2%80%94%E2%80%94%E5%B9%BF%E4%B9%89%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92%E5%AF%BC%E8%AE%BA/" title="回归分析第10讲——广义线性回归导论"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-06</div><div class="info-item-2">回归分析第10讲——广义线性回归导论</div></div><div class="info-2"><div class="info-item-1">一、广义线性回归的概念 通过前面9讲的学习，我们了解了线性回归模型的结构，以及如何估计参数和假设检验。总结来说，线性回归结构的基本假定是，响应变量的期望值可以由自变量的线性预测子得到，即满足： EY=XβEY=X\beta EY=Xβ 在现实应用当中，要满足这个假定其实很苛刻。一方面，某组自变量对应的响应变量取值的分布不一定是正态分布，可以是偏态的、拖尾的；另一方面，响应变量的取值可以是离散的。在这些情况下，线性回归模型就不再适用了。那应该如何处理呢？ 既然是响应变量的问题，那么我们可以考虑，保留自变量的线性结构，但是和响应变量连接时套上一层函数进行转换，也就是满足： g(EY)=Xβg(EY)=X\beta g(EY)=Xβ 这里的g()g()g()被称为联系函数(link function)，是已知且单调光滑的。联系函数，顾名思义，就是通过一个函数把响应变量和线性预测子联系起来，这样既处理了响应变量，也保留了线性成分。 显然，如果我们定义h=g−1(t)h=g^{-1}(t)h=g−1(t)，那么就有EY=h(Xβ)EY=h(X\beta)EY=h(Xβ)。不难猜测，如果g(...</div></div></div></a><a class="pagination-related" href="/2025/10/28/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E7%AC%AC4%E8%AE%B2%E2%80%94%E2%80%94%E5%9F%BA%E4%BA%8ER%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/" title="回归分析第4讲——基于R语言实现线性回归"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-28</div><div class="info-item-2">回归分析第4讲——基于R语言实现线性回归</div></div><div class="info-2"><div class="info-item-1">这一讲为实践内容，我们将学习如何使用R语言建立和拟合线性回归模型，并对模型和参数进行假设检验。 本讲默认读者已经了解R语言的基本语法，能够在自己的电脑中成功编写和运行R脚本。 一、线性回归的建立与解读 1.1 示例数据集介绍 本讲所使用的数据集是加拉帕戈斯群岛的物种数据，需要首先下载faraway包，并导入数据集gala： &gt; install.packages(&quot;faraway&quot;)&gt; data(gala, package = &quot;faraway&quot;)&gt; head(gala[,-2])             Species  Area Elevation Nearest Scruz AdjacentBaltra            58 25.09       346     0.6   0.6     1.84Bartolome         31  1.24       109     0.6  26.3   572.33Caldwell           3  0.21       114     2.8  58....</div></div></div></a><a class="pagination-related" href="/2025/10/30/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E7%AC%AC6%E8%AE%B2%E2%80%94%E2%80%94%E5%9F%BA%E4%BA%8ER%E8%AF%AD%E8%A8%80%E8%AF%8A%E6%96%AD%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/" title="回归分析第6讲——基于R语言诊断线性回归"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-30</div><div class="info-item-2">回归分析第6讲——基于R语言诊断线性回归</div></div><div class="info-2"><div class="info-item-1">这一讲为实践内容，我们将学习如何使用R语言对已经建立的线性回归模型进行诊断。值得注意的是，模型诊断的方法很多，可用的函数也很多，所以并不局限于本讲所提供的方法。 本讲默认读者已经了解R语言的基本语法，能够在自己的电脑中成功编写和运行R脚本。 一、残差诊断 诊断模型，先看残差。对于残差诊断，我们往往从三个方面去考察：  等方差，即残差方差是否为常数； 正态性，即残差是否服从正态分布； 独立性，即各个残差之间是否独立。  1.1 等方差检验 要检验方差是否为常数，最直观的办法就是绘制残差图。绘制残差图时，要以残差值为纵坐标，但横坐标有很多选择，一般我们选择拟合值y^\hat yy^​。对于残差图来说，一般会出现下面三种形式：   最左边是正常情况，也就是残差上下左右均匀地分布在直线Residual=0Residual=0Residual=0附近，没有任何多余地趋势。 中间是异方差，也就是残差分布左右不均匀，往往成放射状或收缩状。 最右边是非线性方差，也就是残差分布上下不均匀，可能需要对响应变量进行幂次变换。  我们来看一个具体的例子。我们使用faraway包中的savings数据集，...</div></div></div></a><a class="pagination-related" href="/2025/10/31/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E7%AC%AC7%E8%AE%B2%E2%80%94%E2%80%94%E5%9F%BA%E4%BA%8ER%E8%AF%AD%E8%A8%80%E4%BC%98%E5%8C%96%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/" title="回归分析第7讲——基于R语言优化线性回归"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-31</div><div class="info-item-2">回归分析第7讲——基于R语言优化线性回归</div></div><div class="info-2"><div class="info-item-1">这一讲为实践内容，是对回归分析第6讲的延伸，我们将学习如何使用R语言对欠佳的线性回归模型进行优化。 本讲默认读者已经了解R语言的基本语法，能够在自己的电脑中成功编写和运行R脚本。 一、残差问题优化 1.1 残差不独立的情形 残差不独立，也就是说模型的协方差阵不满足GM条件。我们假设Cov(e)=σ2ΣCov(e)=\sigma^2\SigmaCov(e)=σ2Σ。在这种情况下，我们可以选择Aitken模型来进行建模。该模型的求解使用广义最小二乘法，我们可以得到解为： β^=(XTΣ−1X)−XTΣ−1Yvar(β^)=σ2(XTΣ−1X)−\begin{aligned} \hat\beta&amp;=(X^T\Sigma^{-1}X)^-X^T\Sigma^{-1}Y\\ var(\hat\beta)&amp;=\sigma^2(X^T\Sigma^{-1}X)^- \end{aligned} β^​var(β^​)​=(XTΣ−1X)−XTΣ−1Y=σ2(XTΣ−1X)−​ 举一个实际例子。我们导入faraway包中的globwarm数据集，使用线性回归模型进行拟合： &gt;...</div></div></div></a><a class="pagination-related" href="/2025/11/05/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E7%AC%AC9%E8%AE%B2%E2%80%94%E2%80%94%E5%9F%BA%E4%BA%8ER%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%B7%AE%E5%88%86%E6%9E%90/" title="回归分析第9讲——基于R语言实现方差分析"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-05</div><div class="info-item-2">回归分析第9讲——基于R语言实现方差分析</div></div><div class="info-2"><div class="info-item-1">这一讲为实践内容，我们将学习如何使用R语言处理模型中的哑变量，并实现方差分析。 本讲默认读者已经了解R语言的基本语法，能够在自己的电脑中成功编写和运行R脚本。 一、哑变量处理 当回归模型中出现属性变量时，我们应当考虑使用哑变量进行处理。我们来看看如何在R语言中引入哑变量。 1.1 二分类变量的哑变量处理 二分类变量，即属性变量只有两个状态，例如患病与否、质量好坏等等。我们使用faraway包中的sexab数据集进行示例，这是一个描述成年女性在儿童时期受到性别霸凌后的创伤后应激障碍（PTSD）的情况，其中ptsd列表示PTSD的值，cpa列表示身体霸凌的标准尺度值，csa列表示是否遭受过性别霸凌： &gt; data(sexab,package = &quot;faraway&quot;)&gt; head(sexab,3)       cpa     ptsd    csa1  2.04786  9.71365 Abused2  0.83895  6.16933 Abused3 -0.24139 15.15926 Abused&gt; tail(sexab,2)       cp...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Redamancy</div><div class="author-info-description">做一颗最稳固的螺丝钉</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/cien-su"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/cien-su" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:zhangyu.educ@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">新人博主，请多关照~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">一、单个0-1响应的逻辑回归模型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E6%95%B0%E6%8D%AE%E9%9B%86%E4%BB%8B%E7%BB%8D%E4%B8%8E%E6%A8%A1%E5%9E%8B%E5%BB%BA%E7%AB%8B"><span class="toc-text">1.1 数据集介绍与模型建立</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E6%A8%A1%E5%9E%8B%E7%9A%84%E6%A3%80%E9%AA%8C"><span class="toc-text">1.2 模型的检验</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%AF%8A%E6%96%AD"><span class="toc-text">1.3 模型的诊断</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">二、多个0-1响应的逻辑回归模型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E6%95%B0%E6%8D%AE%E9%9B%86%E4%BB%8B%E7%BB%8D%E4%B8%8E%E6%A8%A1%E5%9E%8B%E5%BB%BA%E7%AB%8B"><span class="toc-text">2.1 数据集介绍与模型建立</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E8%BF%87%E5%BA%A6%E5%88%86%E6%95%A3%E5%8F%8A%E5%85%B6%E8%A7%A3%E5%86%B3"><span class="toc-text">2.2 过度分散及其解决</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">三、广义逻辑回归模型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%A4%9A%E5%88%86%E7%B1%BB%E6%97%A0%E5%BA%8F%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92%E6%A8%A1%E5%9E%8B"><span class="toc-text">3.1 多分类无序逻辑回归模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E5%A4%9A%E5%88%86%E7%B1%BB%E6%9C%89%E5%BA%8F%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92%E6%A8%A1%E5%9E%8B"><span class="toc-text">3.2 多分类有序逻辑回归模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E4%BA%8C%E9%A1%B9%E5%93%8D%E5%BA%94%E7%9A%84%E4%B8%8D%E5%90%8C%E8%81%94%E7%B3%BB%E5%87%BD%E6%95%B0"><span class="toc-text">3.3 二项响应的不同联系函数</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/17/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E7%AC%AC12%E8%AE%B2%E2%80%94%E2%80%94%E5%9F%BA%E4%BA%8ER%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92/" title="回归分析第12讲——基于R语言实现逻辑回归">回归分析第12讲——基于R语言实现逻辑回归</a><time datetime="2025-11-17T02:47:39.000Z" title="发表于 2025-11-17 10:47:39">2025-11-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/10/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E7%AC%AC11%E8%AE%B2%E2%80%94%E2%80%94%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92%E6%A8%A1%E5%9E%8B/" title="回归分析第11讲——逻辑回归模型">回归分析第11讲——逻辑回归模型</a><time datetime="2025-11-10T02:14:27.000Z" title="发表于 2025-11-10 10:14:27">2025-11-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/06/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E7%AC%AC10%E8%AE%B2%E2%80%94%E2%80%94%E5%B9%BF%E4%B9%89%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92%E5%AF%BC%E8%AE%BA/" title="回归分析第10讲——广义线性回归导论">回归分析第10讲——广义线性回归导论</a><time datetime="2025-11-06T02:03:33.000Z" title="发表于 2025-11-06 10:03:33">2025-11-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/05/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E7%AC%AC9%E8%AE%B2%E2%80%94%E2%80%94%E5%9F%BA%E4%BA%8ER%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%B7%AE%E5%88%86%E6%9E%90/" title="回归分析第9讲——基于R语言实现方差分析">回归分析第9讲——基于R语言实现方差分析</a><time datetime="2025-11-05T02:18:09.000Z" title="发表于 2025-11-05 10:18:09">2025-11-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/03/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90/%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E7%AC%AC8%E8%AE%B2%E2%80%94%E2%80%94%E6%96%B9%E5%B7%AE%E5%88%86%E6%9E%90%E6%A8%A1%E5%9E%8B/" title="回归分析第8讲——方差分析模型">回归分析第8讲——方差分析模型</a><time datetime="2025-11-03T02:14:40.000Z" title="发表于 2025-11-03 10:14:40">2025-11-03</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Redamancy</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.0.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.1</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.1"></script><script src="/js/main.js?v=5.5.1"></script><div class="js-pjax"><script>(async () => {
  const showKatex = () => {
    document.querySelectorAll('#article-container .katex').forEach(el => el.classList.add('katex-show'))
  }

  if (!window.katex_js_css) {
    window.katex_js_css = true
    await btf.getCSS('https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css')
    if (true) {
      await btf.getScript('https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/copy-tex.min.js')
    }
  }

  showKatex()
})()</script></div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.1"></script></div></div></body></html>